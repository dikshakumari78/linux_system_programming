#include <iostream>
#include <fcntl.h>
#include <unistd.h>
#include <cstring>

void handleError(const std::string &message) {
    perror(message.c_str());
    exit(EXIT_FAILURE);
}

int main() {
    const char *fileName = "example.txt";
    int fd = open(fileName, O_WRONLY | O_CREAT | O_TRUNC, S_IRUSR | S_IWUSR);
    if (fd == -1) {
        handleError("Error opening/creating file");
    }

    std::string userInput;
    std::cout << "Enter text to write to the file: ";
    std::getline(std::cin, userInput);
    ssize_t bytesWritten = write(fd, userInput.c_str(), userInput.size());
    if (bytesWritten == -1) {
        handleError("Error writing to file");
    }
    if (close(fd) == -1) {
        handleError("Error closing file after write");
    }
    fd = open(fileName, O_RDONLY);
    if (fd == -1) {
        handleError("Error opening file for reading");
    }
    const size_t bufferSize = 1024;
    char buffer[bufferSize];
    ssize_t bytesRead = read(fd, buffer, bufferSize - 1);
    if (bytesRead == -1) {
        handleError("Error reading from file");
    }
    buffer[bytesRead] = '\0';

    std::cout << "Contents of the file:" << std::endl;
    std::cout << buffer << std::endl;
    if (close(fd) == -1) {
        handleError("Error closing file after read");
    }

    return 0;
}
